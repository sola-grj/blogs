import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,d as t}from"./app-tdQwJvOh.js";const p="/blogs/assets/images/node/nestjs/34.png",o={},e=t(`<p>下载文件的方式有好多种</p><h4 id="_1-download-直接下载" tabindex="-1"><a class="header-anchor" href="#_1-download-直接下载"><span>1.download 直接下载</span></a></h4><p>这个文件信息应该存数据库 演示就写死 了</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  Controller<span class="token punctuation">,</span>
  Post<span class="token punctuation">,</span>
  UseInterceptors<span class="token punctuation">,</span>
  UploadedFile<span class="token punctuation">,</span>
  Get<span class="token punctuation">,</span>
  Res<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/common&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> UploadService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./upload.service&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> FileInterceptor<span class="token punctuation">,</span> FilesInterceptor <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@nestjs/platform-express&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Response <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Controller</span></span><span class="token punctuation">(</span><span class="token string">&quot;upload&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UploadController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">private</span> <span class="token keyword">readonly</span> uploadService<span class="token operator">:</span> UploadService<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Post</span></span><span class="token punctuation">(</span><span class="token string">&quot;album&quot;</span><span class="token punctuation">)</span>
  <span class="token decorator"><span class="token at operator">@</span><span class="token function">UseInterceptors</span></span><span class="token punctuation">(</span><span class="token function">FileInterceptor</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">upload</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">UploadedFile</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token string">&quot;峰峰35岁憋不住了&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">&quot;export&quot;</span><span class="token punctuation">)</span>
  <span class="token function">downLoad</span><span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;../images/1662894316133.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+p+`" alt="全局中间件" tabindex="0" loading="lazy"><figcaption>全局中间件</figcaption></figure><h4 id="_2-使用文件流的方式下载" tabindex="-1"><a class="header-anchor" href="#_2-使用文件流的方式下载"><span>2.使用文件流的方式下载</span></a></h4><p>可以使用 compressing 把他压缩成一个 zip 包</p><p>import {zip} from &#39;compressing&#39;</p><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">Get</span></span><span class="token punctuation">(</span><span class="token string">&#39;stream&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token function">down</span> <span class="token punctuation">(</span><span class="token decorator"><span class="token at operator">@</span><span class="token function">Res</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> res<span class="token operator">:</span>Response<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;../images/1662894316133.png&#39;</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> tarStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">zip</span><span class="token punctuation">.</span><span class="token function">Stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">await</span> tarStream<span class="token punctuation">.</span><span class="token function">addEntry</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>

  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;application/octet-stream&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>

  <span class="token string">&#39;Content-Disposition&#39;</span><span class="token punctuation">,</span>

  <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">attachment; filename=xiaoman</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>

  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  tarStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前端接受流</p><ul><li>前端也可以使用 file-saver 第三方插件进行文件下载</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts" data-title="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">useFetch</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>res<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// type:&quot;image/png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  a<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">&quot;xiaman.zip&quot;</span><span class="token punctuation">;</span>

  a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">download</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:3000/upload/stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,12),c=[e];function i(l,u){return s(),a("div",null,c)}const d=n(o,[["render",i],["__file","nestjs 文件下载.html.vue"]]),m=JSON.parse(`{"path":"/node/nestjs/nestjs%20%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html","title":"nestjs 文件下载","lang":"zh-CN","frontmatter":{"title":"nestjs 文件下载","icon":"gears","order":4,"category":["node"],"tag":["nestjs"],"navbar":true,"sidebar":true,"breadcrumb":true,"pageInfo":false,"contributors":true,"editLink":true,"lastUpdated":true,"prev":true,"next":true,"comment":true,"footer":true,"backtotop":false,"description":"下载文件的方式有好多种 1.download 直接下载 这个文件信息应该存数据库 演示就写死 了 全局中间件全局中间件 2.使用文件流的方式下载 可以使用 compressing 把他压缩成一个 zip 包 import {zip} from 'compressing' 前端接受流 前端也可以使用 file-saver 第三方插件进行文件下载","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blogs/node/nestjs/nestjs%20%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD.html"}],["meta",{"property":"og:site_name","content":"孜然地球"}],["meta",{"property":"og:title","content":"nestjs 文件下载"}],["meta",{"property":"og:description","content":"下载文件的方式有好多种 1.download 直接下载 这个文件信息应该存数据库 演示就写死 了 全局中间件全局中间件 2.使用文件流的方式下载 可以使用 compressing 把他压缩成一个 zip 包 import {zip} from 'compressing' 前端接受流 前端也可以使用 file-saver 第三方插件进行文件下载"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://mister-hope.github.io/blogs/assets/images/node/nestjs/34.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-09T09:39:48.000Z"}],["meta",{"property":"article:author","content":"孜然地球"}],["meta",{"property":"article:tag","content":"nestjs"}],["meta",{"property":"article:modified_time","content":"2025-01-09T09:39:48.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"nestjs 文件下载\\",\\"image\\":[\\"https://mister-hope.github.io/blogs/assets/images/node/nestjs/34.png\\"],\\"dateModified\\":\\"2025-01-09T09:39:48.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"孜然地球\\",\\"url\\":\\"https://mister-hope.com\\"}]}"]]},"headers":[],"git":{"createdTime":1736415588000,"updatedTime":1736415588000,"contributors":[{"name":"garry","email":"Garryg@ecinnovations.com","commits":1}]},"readingTime":{"minutes":0.91,"words":274},"filePathRelative":"node/nestjs/nestjs 文件下载.md","localizedDate":"2025年1月9日","excerpt":"<p>下载文件的方式有好多种</p>\\n<h4>1.download 直接下载</h4>\\n<p>这个文件信息应该存数据库 演示就写死 了</p>\\n<div class=\\"language-typescript\\" data-ext=\\"ts\\" data-title=\\"ts\\"><pre class=\\"language-typescript\\"><code><span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>\\n  Controller<span class=\\"token punctuation\\">,</span>\\n  Post<span class=\\"token punctuation\\">,</span>\\n  UseInterceptors<span class=\\"token punctuation\\">,</span>\\n  UploadedFile<span class=\\"token punctuation\\">,</span>\\n  Get<span class=\\"token punctuation\\">,</span>\\n  Res<span class=\\"token punctuation\\">,</span>\\n<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"@nestjs/common\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span> UploadService <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"./upload.service\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span> FileInterceptor<span class=\\"token punctuation\\">,</span> FilesInterceptor <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"@nestjs/platform-express\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">import</span> <span class=\\"token keyword\\">type</span> <span class=\\"token punctuation\\">{</span> Response <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"express\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span> join <span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"path\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">Controller</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"upload\\"</span><span class=\\"token punctuation\\">)</span>\\n<span class=\\"token keyword\\">export</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">UploadController</span> <span class=\\"token punctuation\\">{</span>\\n  <span class=\\"token function\\">constructor</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">readonly</span> uploadService<span class=\\"token operator\\">:</span> UploadService<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>\\n\\n  <span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">Post</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"album\\"</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">UseInterceptors</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">FileInterceptor</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"file\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token function\\">upload</span><span class=\\"token punctuation\\">(</span><span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">UploadedFile</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> file<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token builtin\\">console</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">log</span><span class=\\"token punctuation\\">(</span>file<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"file\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n    <span class=\\"token keyword\\">return</span> <span class=\\"token string\\">\\"峰峰35岁憋不住了\\"</span><span class=\\"token punctuation\\">;</span>\\n  <span class=\\"token punctuation\\">}</span>\\n\\n  <span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">Get</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"export\\"</span><span class=\\"token punctuation\\">)</span>\\n  <span class=\\"token function\\">downLoad</span><span class=\\"token punctuation\\">(</span><span class=\\"token decorator\\"><span class=\\"token at operator\\">@</span><span class=\\"token function\\">Res</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> res<span class=\\"token operator\\">:</span> Response<span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">const</span> url <span class=\\"token operator\\">=</span> <span class=\\"token function\\">join</span><span class=\\"token punctuation\\">(</span>__dirname<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"../images/1662894316133.png\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n    res<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">download</span><span class=\\"token punctuation\\">(</span>url<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n  <span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre></div>","autoDesc":true}`);export{d as comp,m as data};
